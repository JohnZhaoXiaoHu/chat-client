(window.webpackJsonp = window.webpackJsonp || []).push([['online121'], { 1681: function (e, t, n) {}, '4ec9': function (e, t, n) { 'use strict'; var r = n('6d61'); var a = n('6566'); e.exports = r('Map', function (e) { return function () { return e(this, arguments.length ? arguments[0] : void 0) } }, a) }, 6566: function (e, t, n) { 'use strict'; var r = n('9bf2').f; var a = n('7c73'); var i = n('e2cc'); var s = n('0366'); var o = n('19aa'); var c = n('2266'); var u = n('7dd0'); var l = n('2626'); var d = n('83ab'); var f = n('f183').fastKey; var h = n('69f3'); var p = h.set; var v = h.getterFor; e.exports = { getConstructor: function (e, t, n, u) { var l = e(function (e, r) { o(e, l, t), p(e, { type: t, index: a(null), first: void 0, last: void 0, size: 0 }), d || (e.size = 0), void 0 != r && c(r, e[u], { that: e, AS_ENTRIES: n }) }); var h = v(t); var m = function (e, t, n) { var r; var a; var i = h(e); var s = g(e, t); return s ? s.value = n : (i.last = s = { index: a = f(t, !0), key: t, value: n, previous: r = i.last, next: void 0, removed: !1 }, i.first || (i.first = s), r && (r.next = s), d ? i.size++ : e.size++, a !== 'F' && (i.index[a] = s)), e }; var g = function (e, t) { var n; var r = h(e); var a = f(t); if (a !== 'F') return r.index[a]; for (n = r.first; n; n = n.next) if (n.key == t) return n }; return i(l.prototype, { clear: function () { var e = this; var t = h(e); var n = t.index; var r = t.first; while (r)r.removed = !0, r.previous && (r.previous = r.previous.next = void 0), delete n[r.index], r = r.next; t.first = t.last = void 0, d ? t.size = 0 : e.size = 0 }, delete: function (e) { var t = this; var n = h(t); var r = g(t, e); if (r) { var a = r.next; var i = r.previous; delete n.index[r.index], r.removed = !0, i && (i.next = a), a && (a.previous = i), n.first == r && (n.first = a), n.last == r && (n.last = i), d ? n.size-- : t.size-- } return !!r }, forEach: function (e) { var t; var n = h(this); var r = s(e, arguments.length > 1 ? arguments[1] : void 0, 3); while (t = t ? t.next : n.first) { r(t.value, t.key, this); while (t && t.removed)t = t.previous } }, has: function (e) { return !!g(this, e) } }), i(l.prototype, n ? { get: function (e) { var t = g(this, e); return t && t.value }, set: function (e, t) { return m(this, e === 0 ? 0 : e, t) } } : { add: function (e) { return m(this, e = e === 0 ? 0 : e, e) } }), d && r(l.prototype, 'size', { get: function () { return h(this).size } }), l }, setStrong: function (e, t, n) { var r = t + ' Iterator'; var a = v(t); var i = v(r); u(e, t, function (e, t) { p(this, { type: r, target: e, state: a(e), kind: t, last: void 0 }) }, function () { var e = i(this); var t = e.kind; var n = e.last; while (n && n.removed)n = n.previous; return e.target && (e.last = n = n ? n.next : e.state.first) ? t == 'keys' ? { value: n.key, done: !1 } : t == 'values' ? { value: n.value, done: !1 } : { value: [n.key, n.value], done: !1 } : (e.target = void 0, { value: void 0, done: !0 }) }, n ? 'entries' : 'values', !n, !0), l(t) } } }, '6d61': function (e, t, n) { 'use strict'; var r = n('23e7'); var a = n('da84'); var i = n('94ca'); var s = n('6eeb'); var o = n('f183'); var c = n('2266'); var u = n('19aa'); var l = n('861d'); var d = n('d039'); var f = n('1c7e'); var h = n('d44e'); var p = n('7156'); e.exports = function (e, t, n) { var v = e.indexOf('Map') !== -1; var m = e.indexOf('Weak') !== -1; var g = v ? 'set' : 'add'; var w = a[e]; var x = w && w.prototype; var y = w; var b = {}; var k = function (e) { var t = x[e]; s(x, e, e == 'add' ? function (e) { return t.call(this, e === 0 ? 0 : e), this } : e == 'delete' ? function (e) { return !(m && !l(e)) && t.call(this, e === 0 ? 0 : e) } : e == 'get' ? function (e) { return m && !l(e) ? void 0 : t.call(this, e === 0 ? 0 : e) } : e == 'has' ? function (e) { return !(m && !l(e)) && t.call(this, e === 0 ? 0 : e) } : function (e, n) { return t.call(this, e === 0 ? 0 : e, n), this }) }; if (i(e, typeof w !== 'function' || !(m || x.forEach && !d(function () { (new w()).entries().next() }))))y = n.getConstructor(t, e, v, g), o.REQUIRED = !0; else if (i(e, !0)) { var O = new y(); var R = O[g](m ? {} : -0, 1) != O; var j = d(function () { O.has(1) }); var E = f(function (e) { new w(e) }); var I = !m && d(function () { var e = new w(); var t = 5; while (t--)e[g](t, t); return !e.has(-0) }); E || (y = t(function (t, n) { u(t, y, e); var r = p(new w(), t, y); return void 0 != n && c(n, r[g], { that: r, AS_ENTRIES: v }), r }), y.prototype = x, x.constructor = y), (j || I) && (k('delete'), k('has'), v && k('get')), (I || R) && k(g), m && x.clear && delete x.clear } return b[e] = y, r({ global: !0, forced: y != w }, b), h(y, e), m || n.setStrong(y, e, v), y } }, '7e4d': function (e, t, n) { e.exports = { inner: 'online-1to1_inner_1c08K', local: 'online-1to1_local_cmMp5', messageInner: 'online-1to1_messageInner_1_--p', messages: 'online-1to1_messages_114qZ', callBtn: 'online-1to1_callBtn_1nEZs' } }, a844: function (e, t, n) { 'use strict'; n('a9e3'); var r = n('5530'); var a = (n('1681'), n('8654')); var i = n('58df'); var s = Object(i.a)(a.a); t.a = s.extend({ name: 'v-textarea', props: { autoGrow: Boolean, noResize: Boolean, rowHeight: { type: [Number, String], default: 24, validator: function (e) { return !isNaN(parseFloat(e)) } }, rows: { type: [Number, String], default: 5, validator: function (e) { return !isNaN(parseInt(e, 10)) } } }, computed: { classes: function () { return Object(r.a)({ 'v-textarea': !0, 'v-textarea--auto-grow': this.autoGrow, 'v-textarea--no-resize': this.noResizeHandle }, a.a.options.computed.classes.call(this)) }, noResizeHandle: function () { return this.noResize || this.autoGrow } }, watch: { lazyValue: function () { this.autoGrow && this.$nextTick(this.calculateInputHeight) }, rowHeight: function () { this.autoGrow && this.$nextTick(this.calculateInputHeight) } }, mounted: function () { var e = this; setTimeout(function () { e.autoGrow && e.calculateInputHeight() }, 0) }, methods: { calculateInputHeight: function () { var e = this.$refs.input; if (e) { e.style.height = '0'; var t = e.scrollHeight; var n = parseInt(this.rows, 10) * parseFloat(this.rowHeight); e.style.height = Math.max(n, t) + 'px' } }, genInput: function () { var e = a.a.options.methods.genInput.call(this); return e.tag = 'textarea', delete e.data.attrs.type, e.data.attrs.rows = this.rows, e }, onInput: function (e) { a.a.options.methods.onInput.call(this, e), this.autoGrow && this.calculateInputHeight() }, onKeyDown: function (e) { this.isFocused && e.keyCode === 13 && e.stopPropagation(), this.$emit('keydown', e) } } }) }, e217: function (e, t, n) { 'use strict'; var r = n('7e4d'); var a = n.n(r); n.d(t, 'default', function () { return a.a }) }, e9a9: function (e, t, n) { 'use strict'; n.r(t); var r = function () { var e = this; var t = e.$createElement; var n = e._self._c || t; return n('div', { class: e.$style.inner }, [n('video', { ref: 'remoteVideo', attrs: { id: 'remote' } }), n('video', { ref: 'localVideo', class: e.$style.local, attrs: { id: 'local' } }), n('div', { class: e.$style.messageInner }, [n('div', { class: e.$style.messages }, e._l(e.messages, function (t) { return n('div', [e._v(e._s(t.sender) + ':' + e._s(t.message))]) }), 0), n('v-textarea', { class: e.$style.textarea, attrs: { 'append-icon': 'mdi-send', height: '50px', solo: '' }, on: { 'click:append': e.sendMsg }, nativeOn: { keyup: function (t) { return !t.type.indexOf('key') && e._k(t.keyCode, 'enter', 13, t.key, 'Enter') ? null : e.sendMsg(t) } }, model: { value: e.message, callback: function (t) { e.message = t }, expression: 'message' } })], 1), n('v-btn', { class: e.$style.callBtn, on: { click: e.handleCall } }, [e._v('发起')])], 1) }; var a = []; var i = (n('4160'), n('b0c0'), n('4ec9'), n('d3b7'), n('3ca3'), n('159b'), n('ddb0'), n('96cf'), n('1da1')); var s = n('d4ec'); var o = n('bee2'); var c = n('262e'); var u = n('2caf'); var l = n('9ab4'); var d = n('1b40'); var f = (function (e) { Object(c.a)(n, e); var t = Object(u.a)(n); function n () { var e; return Object(s.a)(this, n), e = t.apply(this, arguments), e.message = '', e.messages = [], e.peer = new RTCPeerConnection({ iceServers: [{ urls: 'turn:numb.viagenie.ca', credential: '123456', username: '2690363124@qq.com' }] }), e.candidateArr = [], e } return Object(o.a)(n, [{ key: 'createMediaStream', value: (function () { var e = Object(i.a)(regeneratorRuntime.mark(function e () { var t, n; return regeneratorRuntime.wrap(function (e) { while (1) switch (e.prev = e.next) { case 0:return t = this.localVideo, n = this.peer, e.next = 3, navigator.mediaDevices.getUserMedia({ audio: !0, video: !0 }); case 3:return this.mediaStream = e.sent, t.srcObject = this.mediaStream, t.onloadedmetadata = Object(i.a)(regeneratorRuntime.mark(function e () { return regeneratorRuntime.wrap(function (e) { while (1) switch (e.prev = e.next) { case 0:return e.next = 2, t.play(); case 2:case 'end':return e.stop() } }, e) })), e.next = 8, n.addStream(this.mediaStream); case 8:case 'end':return e.stop() } }, e, this) })); function t () { return e.apply(this, arguments) } return t }()) }, { key: 'sendMsg', value: function () { var e = this.message; this.dataChannel.send(e), this.messages.push({ sender: '我', message: e }), this.message = '' } }, { key: 'addEvent', value: function () { var e = this; var t = this.remoteVideo; var n = this.peer; n.onaddstream = (function () { var e = Object(i.a)(regeneratorRuntime.mark(function e (n) { return regeneratorRuntime.wrap(function (e) { while (1) switch (e.prev = e.next) { case 0:t.srcObject = n.stream, t.onloadedmetadata = Object(i.a)(regeneratorRuntime.mark(function e () { return regeneratorRuntime.wrap(function (e) { while (1) switch (e.prev = e.next) { case 0:return e.next = 2, t.play(); case 2:case 'end':return e.stop() } }, e) })); case 2:case 'end':return e.stop() } }, e) })); return function (t) { return e.apply(this, arguments) } }()), n.addEventListener('connectionstatechange', function () { var t = e.peer.connectionState; var n = new Map([['closed', '已关闭'], ['connected', '连接成功'], ['connecting', '正在连接'], ['disconnected', '断开连接'], ['failed', '失败'], ['new', '新连接']]); console.log('连接状态:'.concat(n.get(t))) }) } }, { key: 'handleCall', value: (function () { var e = Object(i.a)(regeneratorRuntime.mark(function e () { var t; var n; var r; var a = this; return regeneratorRuntime.wrap(function (e) { while (1) switch (e.prev = e.next) { case 0:return e.prev = 0, t = this.peer, n = this.dataChannel = this.peer.createDataChannel(this.$socket.id), console.log(n), n.onmessage = function (e) { a.messages.push({ sender: '对方', message: e.data }) }, n.onerror = function (e) { console.log(e) }, e.next = 8, this.createMediaStream(); case 8:return t.onicecandidate = (function () { var e = Object(i.a)(regeneratorRuntime.mark(function e (t) { var n; return regeneratorRuntime.wrap(function (e) { while (1) switch (e.prev = e.next) { case 0:n = t.candidate, n && a.$socket.emit('Candidate', n); case 2:case 'end':return e.stop() } }, e) })); return function (t) { return e.apply(this, arguments) } }()), e.next = 11, t.createOffer(); case 11:return r = e.sent, e.next = 14, t.setLocalDescription(r); case 14:this.$socket.emit('OfferICE', r), e.next = 20; break; case 17:e.prev = 17, e.t0 = e.catch(0), e.t0.name === 'TypeError' ? console.log('当前环境不支持视频通话') : e.t0.name === 'NotAllowedError' ? console.log('用户拒绝') : e.t0.name === 'AbortError' ? console.log('中止') : e.t0.name === 'NotFoundError' ? console.log('找不到') : e.t0.name === 'OverConstrainedError' ? console.log('设备无法满足要求') : e.t0.name === 'SecurityError' && console.log('由于安全原因，被禁止'); case 20:case 'end':return e.stop() } }, e, this, [[0, 17]]) })); function t () { return e.apply(this, arguments) } return t }()) }, { key: 'mounted', value: function () { var e = this; console.log(this.$router.resolve('/news')), this.addEvent(), this.peer.ondatachannel = function (t) { var n = e.dataChannel = t.channel; n.onmessage = function (t) { e.messages.push({ sender: '对方', message: t.data }) } }, this.sockets.subscribe('Candidate', (function () { var t = Object(i.a)(regeneratorRuntime.mark(function t (n) { return regeneratorRuntime.wrap(function (t) { while (1) switch (t.prev = t.next) { case 0:e.$socket.id !== n.id && e.candidateArr.push(n.candidate); case 1:case 'end':return t.stop() } }, t) })); return function (e) { return t.apply(this, arguments) } }())), this.sockets.subscribe('OfferICE', (function () { var t = Object(i.a)(regeneratorRuntime.mark(function t (n) { var r, a, s; return regeneratorRuntime.wrap(function (t) { while (1) switch (t.prev = t.next) { case 0:if (r = e.peer, a = e.candidateArr, e.$socket.id === n.id) { t.next = 13; break } return t.next = 4, r.setRemoteDescription(n.offer); case 4:return t.next = 6, e.createMediaStream(); case 6:return a.forEach(function () { var e = Object(i.a)(regeneratorRuntime.mark(function e (t) { return regeneratorRuntime.wrap(function (e) { while (1) switch (e.prev = e.next) { case 0:return e.next = 2, r.addIceCandidate(t); case 2:case 'end':return e.stop() } }, e) })); return function (t) { return e.apply(this, arguments) } }()), t.next = 9, r.createAnswer(); case 9:return s = t.sent, t.next = 12, r.setLocalDescription(s); case 12:e.$socket.emit('Answer', s); case 13:case 'end':return t.stop() } }, t) })); return function (e) { return t.apply(this, arguments) } }())), this.sockets.subscribe('Answer', function (t) { e.$socket.id !== t.id && e.peer.setRemoteDescription(t.answer) }) } }]), n }(d.d)); Object(l.a)([Object(d.c)('localVideo')], f.prototype, 'localVideo', void 0), Object(l.a)([Object(d.c)('remoteVideo')], f.prototype, 'remoteVideo', void 0), f = Object(l.a)([d.a], f); var h = f; var p = h; var v = n('e217'); var m = n('2877'); var g = n('6544'); var w = n.n(g); var x = n('8336'); var y = n('a844'); function b (e) { this.$style = v.default.locals || v.default } var k = Object(m.a)(p, r, a, !1, b, null, null); t.default = k.exports; w()(k, { VBtn: x.a, VTextarea: y.a }) } }])
// # sourceMappingURL=online121.abd49a12.js.map
